# stops the collection of events

parameters:
 - name: repo_name
   default: c_build_tools

steps:
  - task: PowerShell@2
    displayName: 'Stop collection of events'
    inputs:
      targetType: filePath
      workingDirectory: $(Agent.BuildDirectory)/s/${{ parameters.repo_name }}
      filePath: './scripts/stop_trace.ps1'
    continueOnError: true
    condition: always()

  - task: PublishBuildArtifacts@1
    displayName: 'Publish etl files'
    inputs:
      pathtoPublish: '$(Build.ArtifactStagingDirectory)\etl_logs'
      artifactName: 'etl_logs_$(System.JobName)_$(System.JobAttempt)_$(System.JobId)'
      parallel: true
      parallelCount: 8
    condition: or(failed(), canceled())
